&emsp;&emsp;有关为什么要是用并行程序的问题在之前已经进行了简单的探讨。总的来说，最重要的应该是出于两个目的。**第一**，为了获得更好的性能；**第二**，由于业务模型的需要，确实需要多个执行实体。在这里，我将更加关注于第一种情况，也就是有关性能的问题。将串行程序改造为并发，一般来说可以提高程序的整体性能，但是究竟能提高多少甚至说究竟是否真的可以提高，还是一个需要研究的问题。目前，主要有两个定律对这个问题进行解答，一个是Amdahl定律，另外一个是Gustafson定律。

## 1.4.1 Amdahl定律

&emsp;&emsp;Amdahl定律是计算机科学中非常重要的定律。它定义了串行系统并行化后的加速比的计算公式和理论上限。

### 加速比定义：加速比=优化前系统耗时/优化后系统耗时
&emsp;&emsp;即，所谓加速比，就是优化前的耗时与优化后耗时的比值。加速比越高，表明优化效果越明显。以下公式：其中n表示处理器个数，T表示时间，T~1~表示优化前耗时（也就是只有1个处理器时的耗时），T~n~表示使用n个处理器优化后的耗时。F是程序中只能串行执行的比例。

```math
T~n~ = T~1~(F+1/n(1-F))

jsb = T~1~/T~n~ 
    = T~1~/T~1~(F+1/n(1-F))=1/F+1/n(1-F)
```

&emsp;&emsp;根据这个公式，如果CPU处理器数量趋于无穷，那么加速比与系统的串行化率成反比，如果系统中必须有50%的代码串行执行，那么系统的最大加速比为2.

&emsp;&emsp;由此可见，为了提高系统的速度，仅增加CPU处理器的数量并不一定能起到有效的作用。需要从根本上修改程序的串行行为，提高系统内可并行化的模块比重，在此基础上，合理增加并行处理器数量，才能以最小的投入，得到最大的加速比。

&emsp;&emsp;注意：根据Amdahl定律，使用多核CPU对系统进行优化，优化的效果取决于CPU的数量以及系统中的串行化程序的比重。CPU数量越多，串行化比重越低，则优化效果越好。仅提高CPU数量而不降低程序的串行化比重，也无法提高系统性能。

## 1.4.2 Gustafson定律

&emsp;&emsp;Gustafson定律也试图说明处理器个数、串行比例和加速比之间的关系，但是Gustafson定律和Amdahl定律的角度不同。同样，加速比都定义为优化前的系统耗时除以优化后的系统耗时。

```math
jsb = n - F(n-1)
```

&emsp;&emsp;可以看到，由于切入角度的不同，Gustafson定律的公式和Amdahl定律的公式截然不同。从Gustafson定律中，我们可以更容易的发现，如果串行比例很小，并行比例很大，那么加速比就是处理器的个数。只要你不断的累加处理器，就能获得更快的速度。

## 1.4.3 Amdahl定律和Gustafson定律是否相互矛盾

&emsp;&emsp;由于Amdahl定律和Gustafson定律的结论不同，这是不是说明这两个理论之间有一个是错误的呢？其实不然，两者的差异其实是因为这两个定律对同一个客观事实从不同角度去审视后的结果，它们的偏重点有所不同。

&emsp;&emsp;举一个生活的例子，一辆汽车行驶在相聚60公里的诚实。你花了一个小时，行驶了30公里。无论接下来开多快，你都不可能达到90公里/小时的时速。

```math
60/(1+x)=90 x<0
```
即使速度无穷大时速只有60km/hour

&emsp;&emsp;也就是说Amdahl强调：当串行比例一定是，加速比是有上限的，不管你堆叠多少个CPU参与计算，都不能突破这个上限！

&emsp;&emsp;而Gustafson定律的出发点与之不同，对Gustafson定律来说，不管你从A点出发的速度有多慢，只要给你足够的时间和距离，只要你后期的速度比期望值快那么一点点，你总是可以把平均速度调整到非常接近那个期望值的。比如，你想要达到均速90km/hour，即使在前30km你的时速只有30km/hour，只要在很后面的速度达到91km/hour,给你足够的时间和距离，你总有一天可以把均速提高到90km/hour。

&emsp;&emsp;因此，Gustafson定律关心的是：如果可被并行化的代码所占比重足够多，那么加速比就能随着CPU的数量线性增长。

&emsp;&emsp;所以，两个定律并不矛盾。从极端角度来说，如果西安同种没有可悲串行化的代码（即F=1）,那么对于这两个定律，其加速比都是1。繁殖，如果系统中可串行化代码比重达到100%，那么这两个定律得到加速比都是n(处理器个数)。

### 感觉最后一段描述反了，如果没有可被串行化的代码，意思是全部是并行化，F=0，加速比和CPU个数成正比，等于n;如果可串行化代码比重达到100%，F=1,此时加速比最小是1，和CPU个数无关，归根到底，如果并行化比率高时，是和CPU数量正相关的。和Amdahl定律一致的结论，不冲突，都是串行化越高，多核利用率更高
